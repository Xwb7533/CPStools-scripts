# CPStools Usage

Please install Biopython packages before use.

```python
pip install biopython
```



## 1 gbcheck function

### Parameters

gbcheck.py accepts two parameters:

​	-i, --test_file

​	-r, --ref_file

The parameter of -i/--test_file is required, and -r/--ref_file is optional.

If only -i/--TEST_FILE, the gbcheck.py will check the annotation of the input file. The script will check the gene nam in each gene, CDS, tRNA and rRNA. For CDS, tRNA and rRNA, it will also check the 'product' label. 

For CDS, the codon amino acids will be check, if start codon, stop codon and internal codon was wrong, it will print out the location of CDS.

### Usage

```python
python gbcheck.py -i input_file
```

The input_file is genbank format file.  And should end with '.gb'

it will check the simple wrong in the input_file.

```Python
python gbcheck.py -i input_file -r ref_file
```

The input_file and ref_file are genbank format file.  And should end with '.gb'

it will compare gene counts and difference in two GenBank files.



## 2 Sequence adjustment function

There are three scripts in this function:

​	IR.py : identify the four regions in chloroplast genome sequences.

​	LSC_adj.py : adjust the sequence start with the first bp in LSC region.

​	SSC_adj.py : adjust the direction of SSC region.

### Parameters

	#### IR.py

IR.py accepts one parameter:

​	-i, --input_file

The parameter of -i/--input_file is required. The input_file can be Fasta or Genbank format file.

#### LSC_adj.py

LSC_adj.py accepts three parameters, and three parameters are all required:

​	-i, --work_dir

​	-o, --save_dir

​	-f, --info_file

The parameter of -i/--work_dir is the directory of  sequences, which need to adjust to the first bp in LSC region.

The parameter of -o/--save_dir is the directory of  sequences saved.

The parameter of -f/--info_file is the results, get from IR.py and adjusted to one line for each sequences, and separate with tab.

#### SSC_adj.py

This scripts should combine the results of collinearity, which can get from the tool of nucmer.

LSC_adj.py accepts three parameters, and three parameters are all required:

​	-i, --work_dir

​	-o, --save_dir

​	-f, --info_text

The parameter of -i/--work_dir is the directory of  sequences, which need to reverse the SSC region.

The parameter of -o/--save_dir is the directory of  sequences saved.

The parameter of -f/--info_file is the results, get from IR.py and adjusted to one line for each sequences, and separate with tab.



### Usage

#### IR.py

```Python
python IR.py -i input_file 
```

The input_file can be Genbank of Fasta format file. it will find the four regions in the chloroplast sequences, which the IR region should surpass 1,000 bp.

#### LSC_adj.py

```
python LSC_adj.py -i work_dir -o save_dir -f info.txt 
```

The adjusted sequences will be save into save_dir.  -i must be directory

#### SSC_adj.py

```
python SSC_adj.py -i work_dir -o save_dir -f info.txt 
```

The SSC reversed sequences will be save into save_dir.  -i must be directory



## 3 Pi analysis function

There are six scripts in this function:

​	Pi_1.py : Extract intergenic sequences (IGS) from Genbank files

​	Pi_2.py : Obtain common sequences from the extracted IGS sequences

​	Pi_3.py : Calculate Pi values.

​	Pi_4.py: Sorted common intergenic spaces results as cp genome order.

​	Pi_5.py: Extract common gene sequences from Genbank files

​	Pi_6.py: Sorted common gene as cp genome order.

### Parameters

#### Pi_1.py

Pi_1.py accepts one parameter:

​	-i, --work_dir: the directory of Genbank files, which need to extract IGS sequences.

Note : the Genbank files should checked by gbcheck.py

#### Pi_2.py

Pi_2.py accepts one parameter:

​	-i,--ref_fasta: The input ref fasta file is put in the all fasta directory which generated from 06_Pi_1.py

Note : Please select one file as ref fasta from the sequences generated from 06_Pi_1.py

#### Pi_3.py

before run Pi_3.py:

Please run the command:

```shell
cd unalign_common_IGS
mkdir align_IGS
for i in ./*.fasta; do mafft --auto  $i > ./align_IGS/$i ;done
```

The step above was to do the multiple sequence alignment. 

Pi_3.py accepts one parameter:

​	-i,--input_dir: The Aligned fasta format work directory. 'align_IGS'

#### Pi_4.py

Pi_4.py accepts two parameters:

​	-i, input: Input the file path of 'Pi_results.txt', generated by 06_Pi_3.py

​	-r, --reference: Input the file path of 'cp_sort_IGS.txt', generated by 06_Pi_3.py

#### Pi_5.py

Pi_5.py accepts one parameter:

​	-i,--input_file:  All the Genbank files was set at a directory, and choose one file as input_file

Then run the following command to make multi-alignment.

```shell
cd common_gene/
mkdir align_gene
for i in ./*.fasta; do mafft --auto  $i > ./align_gene/$i ;done'
```

#### Pi_6.py

Pi_6.py accepts two parameters:

​	-i, input: Input the file path of 'Pi_results.txt', generated by 06_Pi_3.py

​	-r, --reference: Input the file path of 'cp_sort_IGS.txt', generated by 06_Pi_5.py



### Usage

#### Pi_1.py

```python
python Pi_1.py -i genbank_directory
```

The input is a directory, which contains all the genbank need for Pi analysis. This script will generate two kinds of file, 'txt' and '_IGS.fasta'. In the txt file, it records the location of intergenic, while in IGS.fasta, it is the fasta sequences of IGS. 

Then move the IGS_fasta into one directory

```shell
mkdir fasta
mv *IGS.fasta ./fasta
```

#### Pi_2.py

From fasta directory, select one sequence as input file for Pi_2.py

```python
python Pi_2.py -i ref.fasta
```

Then, to do the multi-alignment

```shell
cd unalign_common_IGS/
mkdir align_IGS
for i in ./*.fasta; do mafft --auto  $i > ./align_IGS/$i ;done
```

#### Pi_3.py

```shell
python Pi_3.py -i align_IGS
```

The calculate result will save into the align_IGS/Pi_results.txt

#### Pi_4.py

Then, to sort  intergenic spaces results as cp genome order.

```
python Pi_4.py -i align_IGS/Pi_results.txt -r ../cp_sort_IGS.txt
```

The cp_sort_IGS.txt is generated from Pi_3.py and saved in the unalign_common_IGS directory.

The sorted results is saved in the 'align_IGS/IGS_sort_as_cp_order.txt'

#### Pi_5.py

Put the all Genbank files into one directory and select one file as reference, then run the Pi_5.py

```
python Pi_5.py -i genbank_directory/ref_genbank_file
```

The extracted common gene was save in the common_gene directory, and the script also give the following command:

```shell
cd common_gene/
mkdir align_gene
for i in ./*.fasta; do mafft --auto  $i > ./align_gene/$i ;done
# Then run the Pi_3.py to calculate the pi values.
python Pi_3.py -i align_gene
```

#### Pi_6.py

```
python Pi_6.py -i align_gene/Pi_results.txt -r ../gene_cp_sort.txt
```

The final result is save into 'align_gene/gene_sort_as_cp_order.txt'.

Note: if the 'rps12' was in the first line, you can move it into the correct location.



## 4 RSCU function

There are one script in this function:

​	RSCU.py: To get RSCU values from genbank files

This script will run as the follow criterion:

​	1: delete the CDS not start with 'ATG';

​	2: Only take one duplicate gene, and delete the pseudo gene

​	3: The CDS length less than --filter_length will also be delete, and filter_length was 

​		set default is 300 bp

Note: before run RSCU.py, the genbank files should be checked by gbcheck.py

### Parameters

RSCU.py accepts two parameters:

​	-i/--work_dir :  Directory of genbank files

​	-l/--filter_length: CDS filter length, default is 300 bp

### Usage

```shell
# Use default filter_length, 300 bp
python RSCU.py -i genbank_directory
# Use specified filter_length, number
python RSCU.py -i genbank_directory -l number
```

For each genbank file, it will generate a directory in the same path of genbank directory. And each genbank file will touch six file.

​	1. remove_duplicated.fasta	:	delete one duplicated gene

​	2. filter_sequences.txt	: 	the sequences was filter out.

​	3. after_filter_300.fasta	:	the saved seuquences surpass filter_length 

​	4. save_sequences_name.txt	:	the saved CDS name

​	5. merge.fasta	:	merge all the sequences into one sequence.	

​	6. RSCU_results.txt:	calculate RSCU values (table=11)

## 5 SSRs function

There are one script in this function:

​	SSR_analysis.py: To find SSRs  from fasta/genbank files

Note: to ensure the accuracy of the results, we should perform collinearity analysis on all sequences, which can be completed under the sequence adjustment function

### Parameters

SSR_analysis.py accepts two parameters:

​	-i/--input_file :  the input file can be Genbank or Fasta format

​	-k/--kmer_lengths: the length of the six types of SSR, default is 10,6,5,4,4,4

### Usage

```shell
# Use default kmer_lengths, 10,6,5,4,4,4
python SSR_analysis.py -i input_file
# Use specified kmer_lengths, number 11,6,5,4,4,3
python SSR_analysis.py -i input_file -k 11,6,5,4,4,3
```



## 6 Phylogenetic analysis function

There are two scripts in this function:

​	common_cds.py: To obtain commom CDS nucleotide sequences from Genbank files

​	common_pro.py: To obtain commom CDS protein sequences from Genbank files

Note: to ensure the accuracy of the results, the Genbank files should checked by gbcheck.py

### Parameters

common_cds.py and common_pro.py both accept two parameters:

​	-i/--ref_file: All the Genbank files was set at a directory, and choose one file as ref_file

​	-o/--output_dir: output directory of fasta files

### Usage

```shell
# The merged cds file is saved in results/merge_cds.fasta
Python common_cds.py -i ref_file.gb -o results
# The merged protein file is saved in results2/merge_pro.fasta
Python common_cds.py -i ref_file.gb -o results2
```



## 7 Format conversion function

There are three scripts in this function:

​	gb2fa.py: To convert Genbank format file into Fasta format.

​	gb2mVISTA.py: To prepare annotation file for mVISTA software.

​	gb2tbl.py: To convert Genbank format file into tabular format.

Note: to ensure the accuracy of the results, the Genbank files should checked by gbcheck.py

### Parameters

#### gb2fa.py 

accepts two parameters:

​	-i/--gb_file:  Input path of genbank file

​	-o/--fa_file: output path of fasta file

#### gb2mVISTA.py and gb2tbl.py 

both accept one parameter:

​	-i/--work_dir: Input directory of genbank files

### Usage

#### gb2fa.py

```shell
python gb2fa -i input.gb -o output.fasta
```



#### gb2tbl.py

```shell
# the genbank is the directory of Genbank format files
python gb2tbl.py -i genbank
```

#### gb2mVISTA.py

```shell
# the genbank is the directory of Genbank format files
python gb2mVISTA.py -i genbank
```















































